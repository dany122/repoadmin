<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم السحاب - التُرَابية</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        /* التنسيق المتوازن الذي اتفقنا عليه سابقاً */
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; margin: 0; direction: rtl; }
        .container { width: 94%; max-width: 700px; margin: 20px auto; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; }
        .header { background: #8b5b29; padding: 25px; text-align: center; color: white; }
        .main-btn { background: #27ae60; color: white; border: none; padding: 18px; width: 90%; display: block; margin: 20px auto; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        .section-box { border: 1px solid #e0e0e0; margin: 15px; border-radius: 12px; }
        .section-header { background: #fdf5eb; padding: 12px; border-bottom: 2px solid #8b5b29; font-weight: bold; color: #8b5b29; }
        .item { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal { display: none; position: fixed; z-index: 1000; inset: 0; background: rgba(0,0,0,0.6); }
        .modal-content { background: white; width: 90%; max-width: 450px; margin: 50px auto; padding: 25px; border-radius: 15px; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>إدارة المكتبة السحابية</h1></div>
    <button class="main-btn" onclick="openM()">➕ إضافة بحث جديد للجميع</button>
    <div id="list"></div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <h3>إضافة بيانات جديدة</h3>
        <input type="text" id="cIn" placeholder="اسم القسم">
        <input type="text" id="tIn" placeholder="العنوان">
        <textarea id="txtIn" rows="5" placeholder="النص..."></textarea>
        <input type="color" id="colIn" value="#ffffff">
        <button onclick="saveToCloud()" style="width:100%; padding:15px; background:#27ae60; color:white; border:none; border-radius:8px;">حفظ في السحاب</button>
        <button onclick="closeM()" style="width:100%; padding:10px; margin-top:10px; background:#eee; border:none;">إلغاء</button>
    </div>
</div>

<script>
    // إعدادات Firebase الخاصة بك
    const firebaseConfig = {
        apiKey: "AIzaSyA3Qp8zzy6FIs1g5ed0HXBkd9FykxGvGR8",
        authDomain: "alturbya.firebaseapp.com",
        projectId: "alturbya",
        storageBucket: "alturbya.firebasestorage.app",
        messagingSenderId: "481479317412",
        appId: "1:481479317412:web:8f070dbc4c87ba5aa59331"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const openM = () => document.getElementById('modal').style.display = 'block';
    const closeM = () => document.getElementById('modal').style.display = 'none';

    async function saveToCloud() {
        const c = document.getElementById('cIn').value.trim();
        const t = document.getElementById('tIn').value.trim();
        const x = document.getElementById('txtIn').value.trim();
        const col = document.getElementById('colIn').value;

        if(!c || !t || !x) return alert("أكمل البيانات");

        await db.collection("researches").add({
            category: c,
            title: t,
            text: x,
            color: col,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        closeM();
        alert("تم النشر للجميع!");
    }

    // جلب البيانات لحظياً
    db.collection("researches").orderBy("createdAt", "desc").onSnapshot((snapshot) => {
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = '';
        snapshot.forEach((doc) => {
            const res = doc.data();
            listDiv.innerHTML += `
                <div class="section-box">
                    <div class="section-header">${res.category}</div>
                    <div class="item">
                        <span>${res.title}</span>
                        <button onclick="deleteItem('${doc.id}')" style="color:red; border:none; background:none; cursor:pointer;">حذف</button>
                    </div>
                </div>`;
        });
    });

    async function deleteItem(id) {
        if(confirm("سيحذف من عند الجميع، هل أنت متأكد؟")) await db.collection("researches").doc(id).delete();
    }
</script>
</body>
    </html>
